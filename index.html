<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>kostispoutakazia Safety Induction — Video & Quiz</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root { --bg:#0b0c10; --card:#16181d; --text:#e6e6e6; --muted:#a8b3bd; --accent:#4aa3ff; --bad:#ff6b6b; --good:#22c55e; }
    * { box-sizing:border-box; }
    body { margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial; color:var(--text); background:linear-gradient(180deg,#0b0c10,#0f1115);}
    header { padding:24px; display:flex; justify-content:space-between; align-items:center; gap:12px; flex-wrap:wrap;}
    .brand { font-weight:700; letter-spacing:.3px }
    .brand small { display:block; font-weight:400; color:var(--muted); font-size:.8rem; }
    .lang-switch { display:flex; gap:8px; align-items:center; flex-wrap:wrap; }
    .btn { padding:10px 14px; border-radius:14px; border:1px solid #2b2f36; background:#1a1d23; color:var(--text); cursor:pointer; }
    .btn[disabled] { opacity:.5; cursor:not-allowed; }
    .btn.accent { background:var(--accent); border-color:transparent; color:#081018; font-weight:600; }
    .btn.ghost { background:transparent; }
    main { max-width:920px; margin:0 auto; padding:0 16px 64px; }
    .card { background:var(--card); border:1px solid #22262d; border-radius:20px; padding:18px; margin:14px 0; }
    .video-wrap { aspect-ratio:16/9; background:#000; border-radius:16px; overflow:hidden; }
    .row { display:flex; gap:14px; align-items:center; flex-wrap:wrap; }
    .meta { color:var(--muted); font-size:.95rem; }
    .pill { padding:6px 10px; border:1px solid #2b2f36; border-radius:999px; color:var(--muted); }
    h1 { font-size:1.6rem; margin:12px 0; }
    h2 { font-size:1.2rem; margin:8px 0 6px; color:#cfe3ff;}
    ol.q { list-style:none; margin:0; padding:0; display:grid; gap:14px; }
    .q-item { padding:16px; border:1px solid #262a32; border-radius:16px; background:#14171d; }
    .q-stem { margin:0 0 8px; font-weight:600; }
    .opts { display:grid; gap:8px; }
    label.opt { display:flex; gap:10px; align-items:flex-start; padding:10px; border:1px solid #262a32; border-radius:12px; cursor:pointer; background:#11151b;}
    label.opt:hover { border-color:#2f343e; }
    input[type="radio"] { transform:translateY(2px); }
    .result { padding:14px; border-radius:14px; }
    .ok { background:#0e1b12; border:1px solid #1e3323; color:#c7f7d1; }
    .bad { background:#2a1212; border:1px solid #402020; color:#ffd1d1; }
    .footer { color:var(--muted); font-size:.9rem; margin-top:8px; text-align:center; }
    .grid-2 { display:grid; grid-template-columns:1fr auto; gap:10px; align-items:center; }
    .hide { display:none !important; }
    .center { text-align:center; }
    .hr { height:1px; background:#22262d; margin:14px 0; }
    a { color:var(--accent); text-decoration:none; }
    a:hover { text-decoration:underline; }
  </style>
</head>
<body>
  <header>
    <div class="brand">
      kostispoutakazia Safety Training
      <small>Construction Site Induction — Video & Quiz</small>
    </div>
    <div class="lang-switch">
      <button id="langEN" class="btn">English</button>
      <button id="langEL" class="btn">Ελληνικά</button>
      <span class="pill" id="progressPill">Video: 0%</span>
    </div>
  </header>

  <main>
    <!-- VIDEO GATE -->
    <section class="card" id="videoGate">
      <div class="grid-2">
        <div>
          <h1 id="t_title">Watch the induction video first</h1>
          <p class="meta" id="t_subtitle">When the video ends, the quiz unlocks.</p>
          <p class="meta"><strong>Client:</strong> kostispoutakazia</p>
        </div>
        <div><button class="btn ghost" id="devBypass">Dev bypass</button></div>
      </div>
      <div class="video-wrap" id="playerContainer">
        <div id="player"></div>
      </div>
      <div class="row" style="justify-content:space-between; margin-top:10px;">
        <div class="meta" id="t_hint">Tip: you must finish the whole video.</div>
        <button id="startBtn" class="btn accent" disabled>Start Quiz</button>
      </div>
    </section>

    <!-- QUIZ -->
    <section class="card hide" id="quizCard">
      <div class="grid-2">
        <h1 id="t_quizTitle">Final Assessment</h1>
        <div class="pill" id="attemptPill">Attempt: 1</div>
      </div>
      <div class="meta" id="t_quizNote">Answer all questions. You need 80% to pass.</div>
      <div class="hr"></div>
      <form id="quizForm">
        <ol class="q" id="qList"></ol>
        <div class="row" style="justify-content:space-between; margin-top:12px;">
          <div class="meta" id="t_privacy">Your answers are stored locally in your browser.</div>
          <button class="btn accent" id="submitBtn" type="submit">Submit</button>
        </div>
      </form>
    </section>

    <!-- RESULTS -->
    <section class="card hide" id="resultsCard">
      <h1 id="t_resultsTitle">Results</h1>
      <div id="scoreBox" class="result"></div>
      <div id="detailBox" class="footer"></div>
      <div class="row" style="margin-top:12px; justify-content:space-between;">
        <button class="btn" id="reviewBtn">Review</button>
        <div class="row">
          <button class="btn" id="retakeBtn">Retake</button>
          <button class="btn accent" id="downloadBtn">Download Certificate (demo)</button>
        </div>
      </div>
    </section>

    <p class="footer">
      Live URL: 
      <a href="https://yourchef462.github.io/kostispoutakazia/" target="_blank" rel="noopener">
        https://yourchef462.github.io/kostispoutakazia/
      </a><br>
      Client: <strong>kostispoutakazia</strong>
    </p>
  </main>

  <!-- YT IFrame API -->
  <script>
    // ---------- Localized strings ----------
    const STR = {
      en: {
        title: "Watch the induction video first",
        subtitle: "When the video ends, the quiz unlocks.",
        hint: "Tip: you must finish the whole video.",
        quizTitle: "Final Assessment",
        quizNote: "Answer all questions. You need 80% to pass.",
        privacy: "Your answers are stored locally in your browser.",
        resultsTitle: "Results",
        passed: (s) => `Passed — Score ${s}%`,
        failed: (s) => `Not passed — Score ${s}%`,
        detail: (corr, total) => `You answered ${corr} out of ${total} correctly.`,
        review: "Review",
        retake: "Retake",
        cert: "Download Certificate (demo)"
      },
      el: {
        title: "Παρακολούθησε πρώτα το βίντεο ενημέρωσης",
        subtitle: "Με το τέλος του βίντεο, ξεκλειδώνει το τεστ.",
        hint: "Συμβουλή: πρέπει να δεις ολόκληρο το βίντεο.",
        quizTitle: "Τελική Αξιολόγηση",
        quizNote: "Απάντησε όλες τις ερωτήσεις. Απαιτείται 80% για επιτυχία.",
        privacy: "Οι απαντήσεις αποθηκεύονται τοπικά στον browser σου.",
        resultsTitle: "Αποτελέσματα",
        passed: (s) => `Επιτυχία — Βαθμός ${s}%`,
        failed: (s) => `Μη επιτυχία — Βαθμός ${s}%`,
        detail: (corr, total) => `Σωστές: ${corr} από ${total}.`,
        review: "Ανασκόπηση",
        retake: "Επανεξέταση",
        cert: "Λήψη Πιστοποιητικού (demo)"
      }
    };

    // ---------- Data model ----------
    // Each question:
    // id, stemVariants: [ {en,el}, {en,el} ], optionsVariants: [ {en:[], el:[], correctIndex}, {…} ]
    const QUESTIONS = [
      {
        id: "q1",
        stemVariants: [
          {
            en: "Why is PPE important on site?",
            el: "Γιατί είναι σημαντικά τα ΜΑΠ (PPE) στο εργοτάξιο;"
          },
          {
            en: "What is the main reason you must wear PPE on a construction site?",
            el: "Ποιος είναι ο βασικός λόγος που πρέπει να φοράς ΜΑΠ σε εργοτάξιο;"
          }
        ],
        optionsVariants: [
          {
            en: ["It reduces injury risk", "It looks professional", "It replaces training", "It helps work faster"],
            el: ["Μειώνει τον κίνδυνο τραυματισμού", "Δείχνει επαγγελματισμό", "Αντικαθιστά την εκπαίδευση", "Βοηθά να δουλεύεις γρηγορότερα"],
            correctIndex: 0
          },
          {
            en: ["It minimizes harm from hazards", "It improves style", "It makes training unnecessary", "It guarantees speed"],
            el: ["Ελαχιστοποιεί τη βλάβη από κινδύνους", "Βελτιώνει το στυλ", "Κάνει την εκπαίδευση περιττή", "Εγγυάται ταχύτητα"],
            correctIndex: 0
          }
        ]
      },
      {
        id: "q2",
        stemVariants: [
          {
            en: "Before starting a task, you should…",
            el: "Πριν ξεκινήσεις μια εργασία, πρέπει να…"
          },
          {
            en: "What is the first thing you do before you begin a job on site?",
            el: "Ποιο είναι το πρώτο πράγμα που κάνεις πριν ξεκινήσεις μια δουλειά στο εργοτάξιο;"
          }
        ],
        optionsVariants: [
          {
            en: ["Assess the risk", "Skip induction", "Rely on others", "Ignore signage"],
            el: ["Κάνεις εκτίμηση κινδύνου", "Παραλείπεις την ενημέρωση", "Βασίζεσαι στους άλλους", "Αγνοείς τη σήμανση"],
            correctIndex: 0
          },
          {
            en: ["Review hazards and controls", "Avoid toolbox talks", "Assume it's safe", "Disregard warnings"],
            el: ["Ελέγχεις κινδύνους και μέτρα", "Αποφεύγεις τα toolbox talks", "Υποθέτεις ότι είναι ασφαλές", "Παραβλέπεις προειδοποιήσεις"],
            correctIndex: 0
          }
        ]
      },
      {
        id: "q3",
        stemVariants: [
          {
            en: "What is the safest way to report a hazard?",
            el: "Ποιος είναι ο ασφαλέστερος τρόπος αναφοράς κινδύνου;"
          },
          {
            en: "How should you correctly report something dangerous you notice on site?",
            el: "Πώς πρέπει να αναφέρεις σωστά κάτι επικίνδυνο που βλέπεις στο χώρο;"
          }
        ],
        optionsVariants: [
          {
            en: ["Follow the site procedure", "Tell a friend after work", "Post on social media", "Ignore it if minor"],
            el: ["Ακολουθείς τη διαδικασία του χώρου", "Το λες σε φίλο μετά", "Το αναρτάς στα social", "Το αγνοείς αν είναι μικρό"],
            correctIndex: 0
          },
          {
            en: ["Use the formal reporting process", "Mention it casually later", "Share publicly online", "Leave it be"],
            el: ["Χρησιμοποιείς επίσημη διαδικασία αναφοράς", "Το αναφέρεις χαλαρά αργότερα", "Το κοινοποιείς δημόσια online", "Το αφήνεις όπως είναι"],
            correctIndex: 0
          }
        ]
      },
      {
        id: "q4",
        stemVariants: [
          {
            en: "When lifting, the best practice is to…",
            el: "Κατά την ανύψωση, η καλύτερη πρακτική είναι να…"
          },
          {
            en: "How should you position your body when lifting a load?",
            el: "Πώς πρέπει να τοποθετείς το σώμα σου όταν σηκώνεις φορτίο;"
          }
        ],
        optionsVariants: [
          {
            en: ["Keep back straight, bend knees", "Twist quickly", "Hold load away", "Lift with a jerk"],
            el: ["Κρατάς ίσια πλάτη, λυγίζεις γόνατα", "Στρέφεσαι γρήγορα", "Κρατάς το φορτίο μακριά", "Σηκώνεις απότομα"],
            correctIndex: 0
          },
          {
            en: ["Maintain neutral spine, use legs", "Rotate mid-lift", "Extend arms fully", "Snatch the load"],
            el: ["Διατηρείς ουδέτερη σπονδυλική στήλη, δουλεύεις με πόδια", "Στρέφεσαι κατά την ανύψωση", "Τεντώνεις τελείως τα χέρια", "Το αρπάζεις απότομα"],
            correctIndex: 0
          }
        ]
      },
      {
        id: "q5",
        stemVariants: [
          {
            en: "What does a red emergency stop do?",
            el: "Τι κάνει το κόκκινο πλήκτρο έκτακτης ανάγκης;"
          },
          {
            en: "Why would you press the red emergency stop button?",
            el: "Για ποιο λόγο θα πατήσεις το κόκκινο πλήκτρο έκτακτης ανάγκης;"
          }
        ],
        optionsVariants: [
          {
            en: ["Stops equipment immediately", "Speeds up machinery", "Sends a text", "Opens a gate"],
            el: ["Σταματά άμεσα τον εξοπλισμό", "Επιταχύνει μηχανήματα", "Στέλνει μήνυμα", "Ανοίγει πύλη"],
            correctIndex: 0
          },
          {
            en: ["Cuts power to the machine", "Boosts performance", "Places a call", "Unlocks access"],
            el: ["Κόβει την τροφοδοσία στο μηχάνημα", "Αυξάνει την απόδοση", "Κάνει κλήση", "Ξεκλειδώνει πρόσβαση"],
            correctIndex: 0
          }
        ]
      },
      {
        id: "q6",
        stemVariants: [
          {
            en: "If you see damaged electrical leads, you…",
            el: "Αν δεις φθαρμένα καλώδια ρεύματος, πρέπει να…"
          },
          {
            en: "What should you do when you find an electrical cable with visible damage?",
            el: "Τι πρέπει να κάνεις όταν βρεις ηλεκτρικό καλώδιο με εμφανή φθορά;"
          }
        ],
        optionsVariants: [
          {
            en: ["Tag out and report", "Wrap with tape and use", "Ignore if working", "Hide it"],
            el: ["Κάνεις απόσυρση/σήμανση και αναφορά", "Τυλίγεις με ταινία και το χρησιμοποιείς", "Το αγνοείς αν δουλεύει", "Το κρύβεις"],
            correctIndex: 0
          },
          {
            en: ["Isolate and notify supervisor", "Quick-fix and proceed", "Carry on regardless", "Conceal the issue"],
            el: ["Απομονώνεις και ειδοποιείς τον επόπτη", "Κάνεις πρόχειρη «επισκευή» και συνεχίζεις", "Συνεχίζεις σαν να μη συμβαίνει τίποτα", "Κρύβεις το πρόβλημα"],
            correctIndex: 0
          }
        ]
      },
      {
        id: "q7",
        stemVariants: [
          {
            en: "Housekeeping on site means…",
            el: "Η τάξη και καθαριότητα στο χώρο σημαίνει…"
          },
          {
            en: "What do we mean by good housekeeping on a construction site?",
            el: "Τι εννοούμε με τον όρο καλή τάξη και καθαριότητα σε εργοτάξιο;"
          }
        ],
        optionsVariants: [
          {
            en: ["Keep areas clear of debris", "Decorate the office", "Store tools anywhere", "Leave spills"],
            el: ["Κρατάς τους χώρους χωρίς μπάζα", "Στολίζεις το γραφείο", "Αφήνεις εργαλεία όπου να ’ναι", "Αφήνεις διαρροές"],
            correctIndex: 0
          },
          {
            en: ["Remove waste and trip hazards", "Add ornaments", "Drop tools randomly", "Ignore leaks"],
            el: ["Απομακρύνεις απόβλητα και παγίδες πτώσης", "Βάζεις διακοσμητικά", "Παρατάς εργαλεία τυχαία", "Αγνοείς διαρροές"],
            correctIndex: 0
          }
        ]
      },
      {
        id: "q8",
        stemVariants: [
          {
            en: "Working at heights requires…",
            el: "Η εργασία σε ύψος απαιτεί…"
          },
          {
            en: "What is essential when you are working at height?",
            el: "Τι είναι απαραίτητο όταν εργάζεσαι σε ύψος;"
          }
        ],
        optionsVariants: [
          {
            en: ["Fall protection and training", "Running on edges", "No supervision", "Loose footwear"],
            el: ["Συστήματα προστασίας πτώσης και εκπαίδευση", "Τρέξιμο σε άκρες", "Χωρίς επίβλεψη", "Χαλαρά παπούτσια"],
            correctIndex: 0
          },
          {
            en: ["Harness/guardrails and competency", "Stepping on parapets", "Skipping permits", "Untied laces"],
            el: ["Ζώνη/κιγκλιδώματα και επάρκεια", "Περπάτημα σε στηθαία", "Παράλειψη αδειών", "Λυτά κορδόνια"],
            correctIndex: 0
          }
        ]
      },
      {
        id: "q9",
        stemVariants: [
          {
            en: "MSDS/SDS documents tell you…",
            el: "Τα MSDS/SDS σου λένε…"
          },
          {
            en: "Why must you read the MSDS/SDS for a product?",
            el: "Γιατί πρέπει να διαβάζεις το MSDS/SDS ενός προϊόντος;"
          }
        ],
        optionsVariants: [
          {
            en: ["Hazards and safe handling", "Price of materials", "Work schedules", "Holiday dates"],
            el: ["Κινδύνους και ασφαλή χειρισμό", "Τιμή υλικών", "Προγράμματα εργασίας", "Ημερομηνίες αδειών"],
            correctIndex: 0
          },
          {
            en: ["Chemical risks and controls", "Supplier discounts", "Shift rosters", "Vacation policy"],
            el: ["Χημικούς κινδύνους και μέτρα προστασίας", "Εκπτώσεις προμηθευτή", "Βάρδιες", "Πολιτική διακοπών"],
            correctIndex: 0
          }
        ]
      },
      {
        id: "q10",
        stemVariants: [
          {
            en: "If an alarm sounds, you should…",
            el: "Αν ακουστεί συναγερμός, πρέπει να…"
          },
          {
            en: "What is the correct action when you hear the site alarm?",
            el: "Ποια είναι η σωστή ενέργεια όταν ακούσεις τον συναγερμό του εργοταξίου;"
          }
        ],
        optionsVariants: [
          {
            en: ["Follow the evacuation plan", "Finish your task first", "Use lifts", "Wait for social media"],
            el: ["Ακολουθήσεις το σχέδιο εκκένωσης", "Τελειώσεις πρώτα τη δουλειά", "Χρησιμοποιήσεις ανελκυστήρες", "Περιμένεις ενημέρωση από social media"],
            correctIndex: 0
          },
          {
            en: ["Go to the assembly point", "Collect extra tools", "Take elevators", "Check online rumors"],
            el: ["Πας στο σημείο συγκέντρωσης", "Μαζεύεις επιπλέον εργαλεία", "Παίρνεις ανελκυστήρα", "Ελέγχεις φήμες online"],
            correctIndex: 0
          }
        ]
      }
    ];

    // ---------- State & storage ----------
    const STORAGE_KEY = "safetyQuiz_wrongCounts_v2";
    const ATTEMPTS_KEY = "safetyQuiz_attempts_v2";
    const LANG_KEY = "safetyQuiz_lang_v1";
    const wrongCounts = JSON.parse(localStorage.getItem(STORAGE_KEY) || "{}");
    const attempts = parseInt(localStorage.getItem(ATTEMPTS_KEY) || "0", 10);
    let currentAttempt = attempts + 1;
    let lang = localStorage.getItem(LANG_KEY) || "en";
    let quizUnlocked = false;

    // ---------- DOM refs ----------
    const t = (k) => STR[lang][k];
    const el = (id) => document.getElementById(id);
    const startBtn = el("startBtn");
    const devBypass = el("devBypass");
    const qList = el("qList");
    const quizCard = el("quizCard");
    const videoGate = el("videoGate");
    const resultsCard = el("resultsCard");
    const attemptPill = el("attemptPill");
    const scoreBox = el("scoreBox");
    const detailBox = el("detailBox");
    const submitBtn = el("submitBtn");
    const reviewBtn = el("reviewBtn");
    const retakeBtn = el("retakeBtn");
    const downloadBtn = el("downloadBtn");
    const progressPill = el("progressPill");

    // ---------- Language init ----------
    function applyLang() {
      el("t_title").textContent = t("title");
      el("t_subtitle").textContent = t("subtitle");
      el("t_hint").textContent = t("hint");
      el("t_quizTitle").textContent = t("quizTitle");
      el("t_quizNote").textContent = t("quizNote");
      el("t_resultsTitle").textContent = t("resultsTitle");
      el("downloadBtn").textContent = t("cert");
      attemptPill.textContent = `Attempt: ${currentAttempt}`;
      localStorage.setItem(LANG_KEY, lang);
    }
    el("langEN").addEventListener("click",()=>{ lang="en"; applyLang(); renderQuiz(); });
    el("langEL").addEventListener("click",()=>{ lang="el"; applyLang(); renderQuiz(); });

    // ---------- Build quiz ----------
    function renderQuiz() {
      qList.innerHTML = "";
      QUESTIONS.forEach((q, idx) => {
        const wc = wrongCounts[q.id] || 0;
        const variant = wc > 0 ? 1 : 0; // if ever failed, show alternate wording
        const stemObj = q.stemVariants[variant];
        const stemText = stemObj[lang === "en" ? "en" : "el"];

        const optsVariant = q.optionsVariants[variant];
        const opts = optsVariant[lang === "en" ? "en" : "el"];
        const correctIndex = optsVariant.correctIndex;

        const li = document.createElement("li");
        li.className = "q-item";
        li.dataset.qid = q.id;
        li.dataset.correct = String(correctIndex);

        const stem = document.createElement("p");
        stem.className = "q-stem";
        stem.textContent = `${idx+1}. ${stemText}`;
        li.appendChild(stem);

        const optsWrap = document.createElement("div");
        optsWrap.className = "opts";

        opts.forEach((text, i) => {
          const id = `${q.id}_${i}`;
          const label = document.createElement("label");
          label.className = "opt";
          label.setAttribute("for", id);

          const radio = document.createElement("input");
          radio.type = "radio";
          radio.name = q.id;
          radio.id = id;
          radio.value = String(i);

          const span = document.createElement("span");
          span.textContent = text;

          label.appendChild(radio);
          label.appendChild(span);
          optsWrap.appendChild(label);
        });

        li.appendChild(optsWrap);
        qList.appendChild(li);
      });
    }

    // ---------- Submit ----------
    document.getElementById("quizForm").addEventListener("submit", (e) => {
      e.preventDefault();
      submitBtn.disabled = true;

      const items = Array.from(document.querySelectorAll(".q-item"));
      let correct = 0;
      const total = items.length;

      items.forEach(item => {
        const qid = item.dataset.qid;
        const picked = item.querySelector('input[type="radio"]:checked');
        const correctIndex = parseInt(item.dataset.correct,10);
        const optLabels = item.querySelectorAll("label.opt");
        optLabels.forEach((l)=>l.style.borderColor = "#262a32"); // reset

        if (!picked) {
          // treat as wrong
          wrongCounts[qid] = (wrongCounts[qid] || 0) + 1;
          optLabels[correctIndex].style.borderColor = "rgba(34,197,94,.7)";
          return;
        }

        const choice = parseInt(picked.value,10);
        if (choice === correctIndex) {
          correct++;
          optLabels[choice].style.borderColor = "rgba(34,197,94,.9)";
        } else {
          wrongCounts[qid] = (wrongCounts[qid] || 0) + 1;
          optLabels[choice].style.borderColor = "rgba(255,107,107,.8)";
          optLabels[correctIndex].style.borderColor = "rgba(34,197,94,.7)";
        }
      });

      const percent = Math.round((correct/total)*100);
      const pass = percent === 100 ? true : percent >= 80;

      // If user did NOT get 100%, next attempt uses alternate wording for ALL questions
      if (percent < 100) {
        QUESTIONS.forEach(q => {
          wrongCounts[q.id] = (wrongCounts[q.id] || 0) + 1;
        });
      }

      // Persist wrong counts & attempts
      localStorage.setItem(STORAGE_KEY, JSON.stringify(wrongCounts));
      localStorage.setItem(ATTEMPTS_KEY, String(currentAttempt));

      scoreBox.className = `result ${pass ? "ok":"bad"}`;
      scoreBox.textContent = pass
        ? STR[lang].passed(percent)
        : STR[lang].failed(percent);
      detailBox.textContent = STR[lang].detail(correct, total);

      quizCard.classList.add("hide");
      resultsCard.classList.remove("hide");
      submitBtn.disabled = false;
    });

    reviewBtn.addEventListener("click", ()=>{
      resultsCard.classList.add("hide");
      quizCard.classList.remove("hide");
    });

    retakeBtn.addEventListener("click", ()=>{
      resultsCard.classList.add("hide");
      quizCard.classList.remove("hide");
      currentAttempt += 1;
      attemptPill.textContent = `Attempt: ${currentAttempt}`;
      renderQuiz();
      window.scrollTo({top:0, behavior:"smooth"});
    });

    // Demo certificate download (not official)
    downloadBtn.addEventListener("click", ()=>{
      const text = [
        "Demo Certificate",
        "Client: kostispoutakazia",
        `Date: ${new Date().toISOString()}`,
        "Status: Local-only sample (not an official White Card)"
      ].join("\n");
      const blob = new Blob([ text ], { type: "text/plain;charset=utf-8" });
      const a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = "certificate-kostispoutakazia-demo.txt";
      a.click();
      URL.revokeObjectURL(a.href);
    });

    // ---------- Video gate ----------
    // New construction safety induction video
    const YT_VIDEO_ID = "SWzcynEMHr8"; // Construction Safety Induction Video
    let ytPlayer = null;
    let watched = false;

    function onYouTubeIframeAPIReady() {
      ytPlayer = new YT.Player('player', {
        videoId: YT_VIDEO_ID,
        playerVars: { rel:0, modestbranding:1 },
        events: {
          'onReady': onPlayerReady,
          'onStateChange': onPlayerStateChange
        }
      });
    }
    function onPlayerReady() {
      // no-op
    }
    function onPlayerStateChange(e) {
      try {
        const dur = ytPlayer.getDuration() || 0;
        const it = setInterval(()=>{
          if (!ytPlayer || dur === 0) return;
          const tNow = ytPlayer.getCurrentTime();
          const pct = Math.min(100, Math.floor((tNow/dur)*100));
          progressPill.textContent = `Video: ${pct}%`;
          if (pct >= 100 || e.data === YT.PlayerState.ENDED) {
            clearInterval(it);
            unlockQuiz();
          }
        }, 800);
      } catch {}
      if (e.data === YT.PlayerState.ENDED) {
        unlockQuiz();
      }
    }
    function unlockQuiz() {
      if (quizUnlocked) return;
      quizUnlocked = true;
      watched = true;
      startBtn.disabled = false;
      progressPill.textContent = "Video: 100%";
    }

    devBypass.addEventListener("click", ()=>{
      unlockQuiz();
    });

    // Load YT API script
    (function(){
      const s = document.createElement('script');
      s.src = "https://www.youtube.com/iframe_api";
      document.head.appendChild(s);
      window.onYouTubeIframeAPIReady = onYouTubeIframeAPIReady;
    })();

    // ---------- Start quiz ----------
    startBtn.addEventListener("click", ()=>{
      if (!watched && !quizUnlocked) return;
      videoGate.classList.add("hide");
      quizCard.classList.remove("hide");
      renderQuiz();
      applyLang();
    });

    // ---------- First paint ----------
    applyLang();
  </script>
</body>
</html>
